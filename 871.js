"use strict";(self.webpackChunkrslang=self.webpackChunkrslang||[]).push([[871],{871:function(e,t){var s=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(i,a){function o(e){try{d(n.next(e))}catch(e){a(e)}}function r(e){try{d(n.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.name="",this.email="",this.id="",this.token="",this.refreshToken="",this.avatara="",this.loadUser()}loadImg(e,t){if(!e.type.startsWith("image/"))return void alert("This is not image!");const s=new FileReader;s.onload=e=>{e.target&&(this.avatara=e.target.result,this.savUser(),document.getElementById("usrimage").src=this.avatara)},s.readAsDataURL(e)}addUser(e,t,n,i){return s(this,void 0,void 0,(function*(){const a=""!=this.avatara?{name:n,email:e,password:t,img_buf:this.avatara}:{name:n,email:e,password:t};fetch("https://sveta077-rslang.herokuapp.com/users",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)}).then((a=>s(this,void 0,void 0,(function*(){if(a.ok){const s=yield a.json();this.id=s.id,this.email=e,this.name=n,console.log("User added",s.id),this.SignIn(e,t,i)}else alert("Users ERROR")})))).catch((()=>console.log("ERROR adding user")))}))}viewAva(e){const t=document.createElement("img");t.classList.add("obj"),e.innerHTML="",e.appendChild(t),t.setAttribute("src",this.avatara)}viewUser(e){document.getElementById("usrname").querySelector("input").value=this.name,document.getElementById("usremail").querySelector("input").value=this.email,document.getElementById("usrpassword").querySelector("input").value="";const t=document.getElementById("usrimage");""!=this.avatara?t.src=this.avatara:t.src=e||""}SignIn(e,t,n){return s(this,void 0,void 0,(function*(){fetch("https://sveta077-rslang.herokuapp.com/signin",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((t=>s(this,void 0,void 0,(function*(){const s=yield t.json();this.id=s.userId,this.token=s.token,this.refreshToken=s.refreshToken,this.email=e,this.name=s.name,console.log("User autorization is successful"),this.savUser(),this.getUser(),n&&""!=n&&(window.location.href=n)})))).catch((()=>alert("ERROR authorization")))}))}getUser(){return s(this,void 0,void 0,(function*(){fetch("https://sveta077-rslang.herokuapp.com/users/"+this.id,{method:"GET",headers:{Authorization:`Bearer ${this.token}`,Accept:"application/json","Content-Type":"application/json"}}).then((e=>s(this,void 0,void 0,(function*(){const t=yield e.json();this.name=t.name,""!=t.img_buf&&(this.avatara=t.img_buf),this.savUser(),this.viewUser()})))).catch((e=>console.log("ERROR get user",e)))}))}addListener(){document.getElementById("usradd").addEventListener("click",(()=>{const e=document.getElementById("usrname").querySelector("input").value,t=document.getElementById("usremail").querySelector("input").value,s=document.getElementById("usrpassword").querySelector("input").value;this.addUser(t,s,e)})),document.getElementById("usrsignin").addEventListener("click",(()=>{const e=document.getElementById("usremail").querySelector("input").value,t=document.getElementById("usrpassword").querySelector("input").value;this.SignIn(e,t)})),document.getElementById("usrsignout").addEventListener("click",(()=>{this.SignOut(),this.viewUser("../assets/img/dravava.jpg")}));const e=document.getElementById("usrimagedropbox");e.addEventListener("dragenter",(e=>{e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("dragover",(e=>{e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("drop",(e=>{if(e.stopPropagation(),e.preventDefault(),e.dataTransfer&&e.dataTransfer.files){const t=document.getElementById("usrimagedropbox");this.loadImg(e.dataTransfer.files[0],t)}}),!1)}loadUser(){if(null!==localStorage.getItem("autority")){const e=JSON.parse(localStorage.getItem("autority"));Object.assign(this,e)}}savUser(){localStorage.setItem("autority",JSON.stringify(this))}newToken(){""!=this.id&&fetch("https://sveta077-rslang.herokuapp.com/users/"+this.id+"/tokens",{method:"GET",headers:{Authorization:`Bearer ${this.refreshToken}`,Accept:"application/json","Content-Type":"application/json"}}).then((e=>s(this,void 0,void 0,(function*(){const t=yield e.json();this.token=t.token,this.refreshToken=t.refreshToken,console.log("New token generated. ID: ",this.id,"  token:",this.token),this.savUser()})))).catch((()=>{console.log("ERROR renew token"),this.SignOut()}))}SignOut(){localStorage.removeItem("autority"),this.id="",this.token="",this.refreshToken="",this.email="",this.name="",this.avatara="",console.log("Sign Out")}}}}]);